name: Build p5sprite API docs

on:
  push:
    branches: [main]      # run only on pushes to main
  workflow_dispatch:      # …or manual trigger

jobs:
  build-docs:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
      - name: 📥  Checkout repository
        uses: actions/checkout@v4

      - name: 🧰  Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: 📦  Install dev-dependencies
        # If you have a package-lock.json, keep "npm ci".  Otherwise use "npm install".
        run: |
          if [ -f package-lock.json ]; then
            npm ci
          else
            npm install
          fi

      - name: 🛠️  Generate JSDoc into ./docs
        env:
          TEMPLATE: node_modules/jsdoc/templates/default
        run: |
          # Ensure output dir is clean
          rm -rf docs
          mkdir docs

          # MAIN COMMAND — note the explicit template path
          npx jsdoc src/p5sprite.js \
            --recurse \
            --destination docs \
            --template "$TEMPLATE"

      - name: 📄  List docs/ (debug)
        run: ls -R docs
